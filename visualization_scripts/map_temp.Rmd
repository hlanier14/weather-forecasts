---
title: "map_temp"
author: "Sai Shreyas Bhavanasi"
date: "11/2/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(ggplot2)
library(usmap)
library(ggthemes)
library(tibble)
library(viridis)
library(dplyr)
df = read.csv("data/vis_data/vis_dat.csv")

df = df %>% 
  filter(Lon > -150 & Lon < -50 & Lat > 20 & Lat< 50)
df = df[!is.na(df$D2_Hi),]
df = df[!is.na(df$Lat),]

library(mapproj)

```

```{r}
# library(raster)
# provinces <- getData(country="Canada", level=1)

ggplot()+ 
  # geom_map(data=county, map=county,
  #                   aes(long, lat, map_id=region),
  #                   color="#2b2b2b", fill=NA, size=0.1)+
  geom_map(data=state, map=state,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=0.2)+
  geom_map(data=usa, map=usa,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=.01)+
  coord_map("polyconic")+
  theme_minimal() +
  
  geom_point(data = df, aes(y = Lat,x= Lon, colour = D2_Hi , stroke = 2))+
  scale_color_viridis(option="magma")+ 
  labs(colour = "Temp") +
  theme(legend.position="right")

```

```{r}

fld <- with(df, interp(x = Lon, y = Lat, z = D2_Hi))
df2 <- melt(fld$z, na.rm = TRUE)
names(df2) <- c("x", "y", "temp")
df2$Lon <- fld$x[df2$x]
df2$Lat <- fld$y[df2$y]
ggplot()+ 
    geom_point(data = df2, aes(y = Lat,x= Lon, colour = temp , stroke = 2))+

  # geom_map(data=county, map=county,
  #                   aes(long, lat, map_id=region),
  #                   color="#2b2b2b", fill=NA, size=0.1)+
  geom_map(data=state, map=state,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=0.2)+
    
  geom_map(data=usa, map=usa,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=.01)+
  coord_map("polyconic")+
  theme_minimal() +
  
  scale_color_viridis(option="magma")+ 
  labs(colour = "Temp") +
  theme(legend.position="right")

```


```{r}
library(ggplot2)
library(reshape2)
library(akima)
# prepare data in long format
fld <- with(df, interp(x = Lon, y = Lat, z = D2_Lo))
df2 <- melt(fld$z, na.rm = TRUE)
names(df2) <- c("x", "y", "temp")
df2$Lon <- fld$x[df2$x]
df2$Lat <- fld$y[df2$y]
state <- map_data("state")
county <- map_data("county")
usa <- map_data("usa")


ggplot() +
  geom_map(data=usa, map=usa,
           aes(long, lat, map_id=region),
           color="black", fill="white", size=.01)+
    geom_tile(data = df2, aes(x = Lon, y = Lat, fill = temp)) +

  geom_map(data=state, map=state,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=0.2)+  # stat_contour() +
    scale_fill_continuous(name = "Temp (F)",low = "yellow", high = "red") +
    xlab("Longitude") +
  ylab("Latitude") +
  theme(panel.background = element_rect(fill = 'lightblue'),
            panel.grid.major = element_blank())


```


```{r}
can = map_data("world", c("canada"))
mex = map_data("world", c("mexico"))

library(ggplot2)
library(reshape2)
library(akima)
# prepare data in long format
fld <- with(df, interp(x = Lon, y = Lat, z = D2_Lo))
df2 <- melt(fld$z, na.rm = TRUE)
names(df2) <- c("x", "y", "temp")
df2$Lon <- fld$x[df2$x]
df2$Lat <- fld$y[df2$y]



ggplot() +
  geom_map(data=usa, map=usa,
           aes(x=long,y= lat, map_id=region),
           color="black", fill="white", size=.1)+
    # geom_tile(data = df2, aes(x = Lon, y = Lat, fill = temp)) +
  geom_map(data=can, map=can,
           aes(long, lat, map_id=region),
           color="black", fill="white", size=.1)+
  geom_map(data=mex, map=mex,
           aes(long, lat, map_id=region),
           color="black", fill="white", size=.1)+
    geom_raster(data = df2, aes(x = Lon, y = Lat, fill = temp), interpolate = T) +
  geom_map(data=state, map=state,
           aes(long, lat, map_id=region),
           color="black", fill=NA, size=0.5)+  # stat_contour() +
    scale_fill_continuous(name = "Temp (F)",low = "yellow", high = "red") +
    xlab("Longitude") +
  ylab("Latitude") +
  ylim(c(25,50))+
    xlim(c(-125,-70))+
  theme(panel.background = element_rect(fill = 'lightblue'),
            panel.grid.major = element_blank(), panel.grid = element_blank())

```

```{r}
library(grid)
outline <- map("usa", plot=FALSE) # returns a list of x/y coords
xrange <- range(outline$x, na.rm=TRUE) # get bounding box
yrange <- range(outline$y, na.rm=TRUE)
xbox <- xrange + c(-2, 2)
ybox <- yrange + c(-2, 2)
# create the grid path in the current device
polypath(c(outline$x, NA, c(xbox, rev(xbox))),
         c(outline$y, NA, rep(ybox, each=2)),
         col="light blue", rule="evenodd")
```

```{r}
library(raster)
dat <- data.frame(x = df$Lon, y = df$Lat, z = df$D2_Lo)
r <- raster(ncol=10, nrow=20)
r[] <- 1:ncell(r)
extent(r) <- extent(c(-20, 20, -20, 20))

r=disaggregate(r,10)
sp
r=mask(r,wrld_simpl)

#plotting
var_df <- as.data.frame(rasterToPoints(r))
```

```{r}
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(maps)
library(ggplot2)
library(reshape2)
library(akima)
# prepare data in long format
fld <- with(df, interp(x = Lon, y = Lat, z = D2_Lo))
df2 <- melt(fld$z, na.rm = TRUE)
names(df2) <- c("x", "y", "temp")
df2$Lon <- fld$x[df2$x]
df2$Lat <- fld$y[df2$y]

states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))
world <- ne_countries(scale = "medium", returnclass = "sf")
usa <- subset(world, admin == "United States of America")
(alaska <- ggplot(data = world) +
     geom_sf(fill = "cornsilk") +
   theme(panel.background = element_rect(fill = 'lightblue'),
            panel.grid.major = element_blank(),
         panel.grid = element_blank())+

    plot.window(c(0,1),c(0,1), xaxs = "i", yaxs = "i")+
     coord_sf( xlim =c(  -139, -180), ylim = c(50,72), expand = FALSE,datum = NA))

(hawaii  <- ggplot(data = usa) +
     geom_sf(fill = "cornsilk") +
  theme(axis.line = element_line(colour = "black"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank()) +
    coord_sf(crs = st_crs(4135), xlim = c(-161, -154), ylim = c(18, 
         23)))

mainland <- ggplot() +
     geom_sf(data = world,fill = "white") +
         geom_raster(data = df2, aes(x = Lon, y = Lat, fill = temp), interpolate = T) +
      geom_sf(data = states, fill = NA) + 
     coord_sf(ylim = c(22,52), xlim =c(-150,-55))+
      scale_fill_continuous(name = "Temp (F)",low = "yellow", high = "red") +

   theme(panel.background = element_rect(fill = 'lightblue'),
            panel.grid.major = element_blank(), panel.grid = element_blank())

mainland +
 annotation_custom(
      grob = ggplotGrob(alaska),
      xmin = -150,
      xmax = -130 ,
      ymin = 20,
      ymax = 35
  ) +
  annotation_custom(
      grob = ggplotGrob(hawaii),
      xmin = -1250000,
      xmax = -1250000 + (-154 - (-161))*120000,
      ymin = -2450000,
      ymax = -2450000 + (23 - 18)*120000
  )

```

